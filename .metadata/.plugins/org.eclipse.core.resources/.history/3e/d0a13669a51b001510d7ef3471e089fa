var fs = require('fs'),
    xml2js = require('xml2js'),
    OAIPMH = require('../lib').OAIPMH;

var parser = new xml2js.Parser();

describe('OAIPMH', function() {
	var doc;
	
	before(function(done) {
		fs.readFile('xml/0.xml', function(err, data) {
			if (err) return done(err);
			
			parser.parseString(data, function (err, document) {
				if (err) return done(err);
				
				doc = new OAIPMH(document);
				
				done();
			});
		});
	});
	
	it ("Sould detect what document has been loaded", function() {
		expect(doc).to.exist;
	});
	
	describe('#root', function() {
	
		it("Should detect OAI:PMH root node", function(done) {
			
			fs.readFile('xml/0.xml', function(err, data) {
				if (err) return done(err);
				
				parser.parseString(data, function (err, document) {
					if (err) return done(err);
					
					var doc = new OAIPMH(document);
					var root = doc.root();
					
					if (root == null) return done("The OAI:PMH root node can not be found");
					done();
			    });
		    });
			
		});
		
	});
	
});





